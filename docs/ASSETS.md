# ComfyUI Assets Manifest & Handling

- **Manifest Location**: Resolution order `VIDAX_ASSETS_CONFIG` → `VA_STATE_DIR/state/config/assets.json` → `config/assets.json` (CWD). Paths can be absolute or relative; `~/` is expanded; relative und `file://`-Pfade werden relativ zum Manifest-Ordner aufgelöst. HTTP-Downloads folgen Redirects (301/302/303/307/308, bis zu 5 Hops) mit gesetztem User-Agent.
- **StateDir Target**: Assets install into `VA_STATE_DIR/state` (default `~/.va/state`):
  - Workflows → `comfyui/workflows/`
  - Models → `comfyui/models/`
  - Gebündelte Quell-Assets (lokale Workflows) → `assets/workflows/`
- **Schema**:
  - `workflows[]` / `models[]` entries: `{id, url, sha256, dest, unpack?}`
  - `dest` resolves relative to StateDir when not absolute (`comfyui/workflows/<file>` or `comfyui/models/<subdir>/<file>` recommended).
  - `unpack=true` expects a zip archive; contents extract into `dest` with a marker `.asset-meta.json`.
  - `policy`: `{on_missing, on_hash_mismatch, allow_insecure_http}` defaults → `download`, `fail`, `false`.
  - Reale SHA-256-Werte sind Pflicht, Platzhalter werden nicht akzeptiert.
  - Der Legacy-Workflow `vidax_text2img_frames` ist entfernt; der Default-Manifest liefert eine leere `workflows`-Liste und verlässt sich ausschließlich auf inline gebaute Wav2Lip-Graphen. SDXL-Experimente benötigen weiterhin manuell platzierte Checkpoints (z. B. `sd_xl_base_1.0.safetensors`) im ComfyUI-Models-Verzeichnis; das Manifest liefert keine Modelle aus.
- **Verification Rules**:
  - SHA-256 is enforced on downloads; mismatches raise `UNSUPPORTED_FORMAT`.
  - Existing files with mismatched hashes honor `on_hash_mismatch` (default fail).
  - Missing assets honor `on_missing` (default download; otherwise `INPUT_NOT_FOUND`).
  - `allow_insecure_http=false` blocks `http://` sources.
- **Install/Check**:
  - `va install` and `POST /install` perform downloads + verification; failures bubble as `UNSUPPORTED_FORMAT` for hash mismatches/download issues or `OUTPUT_WRITE_FAILED` for write/unzip errors. Install führt keine lokalen Workflow-Kopien mehr aus und verlässt sich ausschließlich auf das Manifest (das standardmäßig keine Workflows enthält).
  - `GET /install/status` reports `ok`/`missing`/`hash_mismatch`/`unknown` without downloading.
  - Job start prüft Assets nur blocking, wenn ComfyUI auto-gestartet werden muss; laufende Instanzen mit `ok`-Health überspringen Blocking, fehlende Einträge erscheinen weiterhin in den Status-Reports.
- **Tooling Requirements**: `unzip` must exist on PATH for `unpack=true`. If absent, the asset stays uninstalled and the install step fails with `OUTPUT_WRITE_FAILED`.
